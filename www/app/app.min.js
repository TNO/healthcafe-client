!function(){var e=["healthcafe.generic","healthcafe.intro","healthcafe.login","healthcafe.bloodpressure","healthcafe.bodyweight","healthcafe.bmi","healthcafe.bloodglucose","healthcafe.cholesterol","healthcafe.timeline","healthcafe.remarks"];angular.module("healthcafe",["ionic","ngMessages","angularUUID2","angular-timeline"].concat(e)).run(function(e){e.ready(function(){window.cordova&&window.cordova.plugins&&window.cordova.plugins.Keyboard&&(cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),cordova.plugins.Keyboard.disableScroll(!0)),window.StatusBar&&StatusBar.styleDefault()})});for(idx in e)angular.module(e[idx],[])}(),function(){var e={env:"test",dev:{api:{urls:{authorization:"http://localhost:8080/nrc/oauth/authorize",redirect:"http://localhost:8100/app/login/oauth_callback.html",dataPoints:"http://localhost:8080/nrc/api/openmhealth/v1/dataPoints"},key:"mbm85kztfalztd2fft5fl5w7hmmdar5nnlktkgkk"}},test:{api:{urls:{authorization:"https://humanstudies.tno.nl/healthcafe/oauth/authorize",redirect:"http://isdatsoftwareontwikkeling.nl/projecten/healthcafe/app/login/oauth_callback.html",dataPoints:"https://humanstudies.tno.nl/healthcafe/api/openmhealth/v1/dataPoints"},key:"hm2lkbxyssh9vvsn4tjpknavhqifmkzmucrl500o"}}};e.current=function(){return e[e.env]},angular.module("healthcafe").constant("config",e).config(function(e){e.interceptors.push("OAuth2Interceptor")})}(),function(){angular.module("healthcafe").config(function(e,t){var o=[{name:"bloodpressure",controllerPrefix:"BloodPressure"},{name:"bodyweight",controllerPrefix:"BodyWeight"},{name:"bmi",controllerPrefix:"BMI"},{name:"bloodglucose",controllerPrefix:"BloodGlucose"},{name:"cholesterol",controllerPrefix:"Cholesterol"}];e.state("app",{url:"/app","abstract":!0,templateUrl:"app/layout.html",controller:"AppController as app"}).state("app.intro",{url:"/intro",views:{mainContent:{templateUrl:"app/intro/intro.html",controller:"IntroController as intro"}}}).state("app.timeline",{url:"/timeline",cache:!1,views:{mainContent:{templateUrl:"app/timeline/timeline.html",controller:"TimelineController as timeline"}}}).state("app.remarks_add",{url:"/remarks/add",views:{mainContent:{templateUrl:"app/remarks/create.html",controller:"RemarksCreateController as remarks"}}});for(i in o){var n=o[i];e.state("app."+n.name,{url:"/"+n.name,cache:!1,views:{mainContent:{templateUrl:"app/"+n.name+"/chart.html",controller:n.controllerPrefix+"Controller as "+n.name}}}).state("app."+n.name+"_add",{url:"/"+n.name+"/add",views:{mainContent:{templateUrl:"app/"+n.name+"/create.html",controller:n.controllerPrefix+"CreateController as "+n.name}}}).state("app."+n.name+"_info",{url:"/"+n.name+"/info",views:{mainContent:{templateUrl:"app/"+n.name+"/info.html",controller:"GenericInfoController as info"}}})}t.otherwise("/app/intro")})}(),function(){function e(e,t,o,n){var r=this;return r.loginData={},r.isAuthenticated=n.isAuthenticated(),r.login=n.login,r.logoff=function(){n.logoff(),r.isAuthenticated=!1,t.toggleLeft(!1),o.nextViewOptions({disableBack:!0,historyRoot:!0})},r}angular.module("healthcafe").controller("AppController",e),e.$inject=["$state","$ionicSideMenuDelegate","$ionicHistory","OAuth2"]}(),function(){function e(e,t,o){var n=this;return e.model=o,e.selector=".bloodglucose-container",e.chartableProperties="blood-glucose",e.chartOptions={measures:{"blood-glucose":{valueKeyPath:"body.blood_glucose.value",range:void 0,units:"mg/dL"}}},angular.extend(n,t("GenericChartController",{$scope:e})),n}angular.module("healthcafe.bloodglucose").controller("BloodGlucoseController",e),e.$inject=["$scope","$controller","BloodGlucose"]}(),function(){function e(e){return e.getInstance({namespace:"omh",name:"blood-glucose",version:"1.0"},function(e){return{blood_glucose:{value:e.level,unit:"mmHg"},temporal_relationship_to_meal:e.relationship_to_meal}})}angular.module("healthcafe.bloodglucose").factory("BloodGlucose",e),e.$inject=["Datapoints"]}(),function(){function e(e,t,o){var n=this;return e.model=o,angular.extend(n,t("GenericCreateController",{$scope:e})),n.relationships_to_meal=[{name:"fasting"},{name:"not fasting"}],n}angular.module("healthcafe.bloodglucose").controller("BloodGlucoseCreateController",e),e.$inject=["$scope","$controller","BloodGlucose"]}(),function(){function e(e,t,o){var n=this;return e.model=o,e.selector=".bloodpressure-container",e.chartableProperties="systolic_blood_pressure, diastolic_blood_pressure",e.chartOptions={userInterface:{tooltips:{contentFormatter:function(e){var t=e.omhDatum.body.systolic_blood_pressure.value.toFixed(0),o=e.omhDatum.body.diastolic_blood_pressure.value.toFixed(0);return t+"/"+o}}}},angular.extend(n,t("GenericChartController",{$scope:e})),n}angular.module("healthcafe.bloodpressure").controller("BloodPressureController",e),e.$inject=["$scope","$controller","BloodPressure"]}(),function(){function e(e){return e.getInstance({namespace:"omh",name:"blood-pressure",version:"1.0"},function(e){return{systolic_blood_pressure:{value:e.systolic,unit:"mmHg"},diastolic_blood_pressure:{value:e.diastolic,unit:"mmHg"}}})}angular.module("healthcafe.bloodpressure").factory("BloodPressure",e),e.$inject=["Datapoints"]}(),function(){function e(e,t,o){var n=this;return e.model=o,angular.extend(n,t("GenericCreateController",{$scope:e})),n}angular.module("healthcafe.bloodpressure").controller("BloodPressureCreateController",e),e.$inject=["$scope","$controller","BloodPressure"]}(),function(){function e(e,t,o){var n=this;return e.model=o,e.selector=".bodyweight-container",e.chartableProperties="body_weight",e.chartOptions={measures:{body_weight:{range:void 0,thresholds:void 0}}},angular.extend(n,t("GenericChartController",{$scope:e})),n}angular.module("healthcafe.bodyweight").controller("BodyWeightController",e),e.$inject=["$scope","$controller","BodyWeight"]}(),function(){function e(e){return e.getInstance({namespace:"omh",name:"body-weight",version:"1.0"},function(e){return{body_weight:{value:e.weight,unit:"kg"}}})}angular.module("healthcafe.bodyweight").factory("BodyWeight",e),e.$inject=["Datapoints"]}(),function(){function e(e,t,o){var n=this;return e.model=o,angular.extend(n,t("GenericCreateController",{$scope:e})),n}angular.module("healthcafe.bodyweight").controller("BodyWeightCreateController",e),e.$inject=["$scope","$controller","BodyWeight"]}(),function(){function e(e,t,o){var n=this;return e.model=o,e.selector=".bmi-container",e.chartableProperties="body-mass-index",e.chartOptions={measures:{"body-mass-index":{valueKeyPath:"body.body_mass_index.value",range:void 0,units:"kg/m2",thresholds:{min:18,max:25}}}},angular.extend(n,t("GenericChartController",{$scope:e})),n}angular.module("healthcafe.bmi").controller("BMIController",e),e.$inject=["$scope","$controller","BMI"]}(),function(){function e(e){return e.getInstance({namespace:"omh",name:"body-mass-index",version:"1.0"},function(e){return console.log("Convert data point BMI"),{body_mass_index:{value:e.weight/(e.length*e.length),unit:"kg/m2"}}})}angular.module("healthcafe.bmi").factory("BMI",e),e.$inject=["Datapoints"]}(),function(){function e(e,t,o){var n=this;return e.model=o,angular.extend(n,t("GenericCreateController",{$scope:e})),n}angular.module("healthcafe.bmi").controller("BMICreateController",e),e.$inject=["$scope","$controller","BMI"]}(),function(){function e(e,t,o){var n=this;return e.model=o,e.selector=".cholesterol-container",e.chartableProperties="total-cholesterol,ldl-cholesterol,hdl-cholesterol,triglycerides",e.chartOptions={userInterface:{legend:!0,thresholds:{show:!1},tooltips:{grouped:!1,contentFormatter:function(e){return e.y.toFixed(1)}}},measures:{"total-cholesterol":{valueKeyPath:"body.blood_total_cholesterol.value",range:void 0,seriesName:"Total Cholesterol",units:"mg/dL",chart:{pointFillColor:"#4a90e2",pointStrokeColor:"#0066d6"},thresholds:[{name:"Desirable",max:200},{name:"Borderline high",min:200,max:240},{name:"High",min:240}]},"ldl-cholesterol":{valueKeyPath:"body.blood_ldl_cholesterol.value",range:{min:0,max:20},seriesName:"LDL Cholesterol",units:"mg/dL",chart:{pointFillColor:"#E24A4A",pointStrokeColor:"#D60000"}},"hdl-cholesterol":{valueKeyPath:"body.blood_hdl_cholesterol.value",range:{min:0,max:20},units:"mg/dL",seriesName:"HDL Cholesterol",chart:{pointFillColor:"#4AE250",pointStrokeColor:"#00D605"}},triglycerides:{valueKeyPath:"body.blood_triglycerides.value",range:void 0,units:"mg/dL",seriesName:"Triglycerides",chart:{pointFillColor:"#DA4AE2",pointStrokeColor:"#CB00D6"}}}},angular.extend(n,t("GenericChartController",{$scope:e})),n}angular.module("healthcafe.cholesterol").controller("CholesterolController",e),e.$inject=["$scope","$controller","Cholesterol"]}(),function(){function e(e){return e.getInstance({namespace:"nrc",name:"cholesterol",version:"0.1"},function(e){var t={blood_total_cholesterol:{value:e.total,unit:"mg/dL"}};return e.ldl&&(t.blood_ldl_cholesterol={value:e.ldl,unit:"mg/dL"}),e.hdl&&(t.blood_hdl_cholesterol={value:e.hdl,unit:"mg/dL"}),e.triglycerides&&(t.blood_triglycerides={value:e.triglycerides,unit:"mg/dL"}),t})}angular.module("healthcafe.cholesterol").factory("Cholesterol",e),e.$inject=["Datapoints"]}(),function(){function e(e,t,o){var n=this;return e.model=o,angular.extend(n,t("GenericCreateController",{$scope:e})),n}angular.module("healthcafe.cholesterol").controller("CholesterolCreateController",e),e.$inject=["$scope","$controller","Cholesterol"]}(),function(){function e(e,t,o){function n(){if(!c.chart){if(!c.events||0==c.events.length)return;r(c.events)}return c.chart}function r(t){c.chart&&c.chart.destroy();var o=d3.select(e.selector);c.chart=new OMHWebVisualizations.Chart(t,o,e.chartableProperties,e.chartOptions)}function a(){var t=d3.select(e.selector),o=n();o&&o.renderTo(t.select("svg").node())}function l(){c.events=[],e.model.list().then(function(e){c.events=e,a(e)})}function i(){c.events=[],e.model.load().then(function(e){c.events=e,a(e)})}var c=this;return c.chart=null,c.remove=function(t){e.model.remove(t).then(function(){i()})},l(),e.$on("$ionicView.enter",function(){t.canDragContent(!1),angular.element(o).bind("resize",a)}),e.$on("$ionicView.leave",function(){t.canDragContent(!0),angular.element(o).unbind("resize",a)}),c}angular.module("healthcafe.generic").controller("GenericChartController",e),e.$inject=["$scope","$ionicSideMenuDelegate","$window"]}(),function(){function e(e,t){var o=this;return o.data="undefined"!=typeof e.model.defaults?e.model.defaults():{},o.save=function(){console.log("SAVING!"),e.model.create(o.data).then(function(o){e.model.load().then(function(){t.goBack()})})},o}angular.module("healthcafe.generic").controller("GenericCreateController",e),e.$inject=["$scope","$ionicHistory"]}(),function(){function e(e,t,o,n,r){var a=function(e,t){this.schema=e,this.converter=t,this.cache=null};return a.prototype.load=function(){var t=r.current().api.urls.dataPoints+"?schema_namespace="+encodeURIComponent(this.schema.namespace)+"&schema_name="+encodeURIComponent(this.schema.name)+"&schema_version="+encodeURIComponent(this.schema.version),o=this;return e.get(t).then(function(e){return o.cache=e.data,o.cache})},a.prototype.list=function(){return this.cache?t.when(this.cache):this.load()},a.prototype.get=function(t){var o=r.current().api.urls.dataPoints+"/"+t;return e.get(o)},a.prototype.remove=function(t){var o=r.current().api.urls.dataPoints+"/"+t;return e["delete"](o)},a.prototype.create=function(t){var o=r.current().api.urls.dataPoints;this.converter&&(t=this.converter(t));var n=this.createDatapoint(t);return e.post(o,n)},a.prototype.defaults=function(){return{}},a.prototype.chartableProperties=function(){return this.propertyNames},a.prototype.createDatapoint=function(e){return{header:{id:o.newuuid(),creation_date_time:new Date,acquisition_provenance:{source_name:"Manual",source_creation_date_time:new Date,modality:"self-reported"},schema_id:this.schema},body:e}},{getInstance:function(e,t){return new a(e,t)}}}angular.module("healthcafe.generic").factory("Datapoints",e),e.$inject=["$http","$q","uuid2","OAuth2","config"]}(),function(){function e(){var e=this;return e}angular.module("healthcafe.generic").controller("GenericInfoController",e)}(),function(){function e(e,t,o){var n=this;return e.$on("event:auth-unauthorized",function(e,t){o.login()}),n.resetNav=function(){t.nextViewOptions({disableBack:!0})},this}angular.module("healthcafe.intro").controller("IntroController",e),e.$inject=["$scope","$ionicHistory","OAuth2"]}(),function(){function e(e){function t(){var e=window.localStorage.getItem("token");return e?JSON.parse(e):null}function o(){return!!t()}function n(){var e=t();return e?e.oauth.access_token:null}function r(){var t=e.current().api;url=t.urls.authorization+"?client_id="+t.key+"&redirect_uri="+encodeURIComponent(t.urls.redirect)+"&response_type=token&scope=read_data_points write_data_points delete_data_points",window.location.href=url}function a(){window.localStorage.removeItem("token")}return{isAuthenticated:o,getAccessToken:n,login:r,logoff:a}}angular.module("healthcafe.login").factory("OAuth2",e),e.$inject=["config"]}(),function(){function e(e,t,o){function n(t){return t.headers.Authorization="Bearer "+e.getAccessToken(),t}function r(e){var n=e.config||{};if(!n.ignoreAuthModule)switch(e.status){case 401:t.$broadcast("event:auth-unauthorized",e);break;case 403:t.$broadcast("event:auth-forbidden",e)}return o.reject(e)}return{request:n,responseError:r}}angular.module("healthcafe.login").factory("OAuth2Interceptor",e),e.$inject=["OAuth2","$rootScope","$q"]}(),function(){function e(e){function t(){n.remarks=[],e.list().then(function(e){n.remarks=e})}function o(){n.remarks=[],e.load().then(function(e){n.remarks=e})}var n=this;return n.remove=function(t){e.remove(t).then(function(){o()})},t(),n}angular.module("healthcafe.remarks").controller("RemarksController",e),e.$inject=["Remarks"]}(),function(){function e(e){function t(){return e.when(a)}function o(t){for(i=0;i<a.length;i++)if(a[i].id==t)return e.when(a[i]);return e.fail("Not found")}function n(t){for(i=0;i<a.length;i++)if(a[i].id==t)return e.when(a.splice(i,1));return e.fail("Not found")}function r(t){return t.id||(t.id=Math.max.apply(null,a.map(function(e){return e.id}))+1),a.push(t),e.when(t)}var a=[{id:1,date:new Date(2016,0,1,10,20,30),message:"Started using blood pressure medicine"},{id:2,date:new Date(2016,0,9,10,20,30),message:"Severe flu"}];return{create:r,load:t,list:t,remove:n,get:o,defaults:function(){return{date:new Date}}}}angular.module("healthcafe.remarks").factory("Remarks",e),e.$inject=["$q"]}(),function(){function e(e,t,o){var n=this;return e.model=o,angular.extend(n,t("GenericCreateController",{$scope:e})),n}angular.module("healthcafe.remarks").controller("RemarksCreateController",e),e.$inject=["$scope","$controller","Remarks"]}(),function(){function e(e,t,o,n,r,a,l,i,c){function u(e){return{id:e.header.id,datapoint:e,date:e.body.effective_time_frame.date_time,badgeIconClass:p[e.header.schema_id.name].icon,badgeClass:e.header.schema_id.name,type:"measurement",measurementType:e.header.schema_id.name,model:p[e.header.schema_id.name].model}}function s(e){return angular.extend({},e,{badgeIconClass:"ion-flash",badgeClass:"remark",type:"intervention",model:a})}function d(e){var t=h(e.map(function(e){return e.map(function(e){return e.header&&e.body?u(e):s(e)})}));return t.sort(function(e,t){return new Date(t.date)-new Date(e.date)})}function h(e){return[].concat.apply([],e)}function m(e){f.events=[],l.all(e.map(function(e){return e.list()})).then(function(e){f.events=d(e)})}var f=this,p={"blood-pressure":{icon:"ion-compass",model:e},"body-weight":{icon:"ion-speedometer",model:t},"body-mass-index":{icon:"ion-ios-flame",model:o},"blood-glucose":{icon:"ion-fork",model:n},cholesterol:{icon:"ion-medkit",model:r}};return f.load=function(){var l=[e,t,n,o,r,a];m(l)},f.load(),f.remove=function(e){confirm("Are you sure?")&&e.model.remove(e.id).then(function(){return e.removed=!0,c(function(){},200)}).then(function(){return e.model.load()}).then(function(){return f.load()})},i.fromTemplateUrl("app/timeline/add_menu.html").then(function(e){f.popover=e}),f}angular.module("healthcafe.timeline").controller("TimelineController",e),e.$inject=["BloodPressure","BodyWeight","BMI","BloodGlucose","Cholesterol","Remarks","$q","$ionicPopover","$timeout"]}();