function GenericCreateController(e,t){var n=this;return n.data="undefined"!=typeof t.defaults?t.defaults():{},n.save=function(){t.create(n.data).then(function(n){t.load().then(function(){e.goBack()})})},n}function GenericListController(e){function t(){o.dataPoints=[],e.list().then(function(e){o.datapoints=e})}function n(){o.dataPoints=[],e.load().then(function(e){o.datapoints=e})}var o=this;return o.remove=function(t){e.remove(t).then(function(){n()})},t(),o}!function(){var e={env:"dev",dev:{api:{urls:{autorization:"http://localhost:8080/nrc/oauth/authorize",redirect:"http://localhost:8100/app/login/oauth_callback.html"},key:"mbm85kztfalztd2fft5fl5w7hmmdar5nnlktkgkk"}}};e.current=function(){return e[e.env]},angular.module("healthcafe").constant("config",e).config(function(e){e.interceptors.push("OAuth2Interceptor")})}(),function(){function e(e,t,n,o){var r=this;return r.loginData={},r.isAuthenticated=o.isAuthenticated(),r.login=o.login,r.logoff=function(){o.logoff(),r.isAuthenticated=!1,t.toggleLeft(!1),n.nextViewOptions({disableBack:!0,historyRoot:!0})},r}angular.module("healthcafe").controller("AppController",e),e.$inject=["$state","$ionicSideMenuDelegate","$ionicHistory","OAuth2"]}(),function(){var e=["healthcafe.generic","healthcafe.intro","healthcafe.login","healthcafe.bloodpressure","healthcafe.bodyweight","healthcafe.timeline","healthcafe.remarks"];angular.module("healthcafe",["ionic","ngMessages","angularUUID2","angular-timeline"].concat(e)).run(function(e){e.ready(function(){window.cordova&&window.cordova.plugins&&window.cordova.plugins.Keyboard&&(cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),cordova.plugins.Keyboard.disableScroll(!0)),window.StatusBar&&StatusBar.styleDefault()})});for(idx in e)angular.module(e[idx],[])}(),function(){angular.module("healthcafe").config(function(e,t){e.state("app",{url:"/app","abstract":!0,templateUrl:"app/layout.html",controller:"AppController as app"}).state("app.intro",{url:"/intro",views:{mainContent:{templateUrl:"app/intro/intro.html",controller:"IntroController as intro"}}}).state("app.timeline",{url:"/timeline",cache:!1,views:{mainContent:{templateUrl:"app/timeline/timeline.html",controller:"TimelineController as timeline"}}}).state("app.bloodpressure",{url:"/bloodpressure",cache:!1,views:{mainContent:{templateUrl:"app/bloodpressure/list.html",controller:"BloodPressureController as bloodpressure"}}}).state("app.bloodpressure_add",{url:"/bloodpressure/add",views:{mainContent:{templateUrl:"app/bloodpressure/create.html",controller:"BloodPressureCreateController as bloodpressure"}}}).state("app.bodyweight_add",{url:"/bodyweight/add",views:{mainContent:{templateUrl:"app/bodyweight/create.html",controller:"BodyWeightCreateController as bodyweight"}}}).state("app.remarks_add",{url:"/remarks/add",views:{mainContent:{templateUrl:"app/remarks/create.html",controller:"RemarksCreateController as remarks"}}}),t.otherwise("/app/intro")})}(),function(){function e(e){function t(){o.events=[],e.list().then(function(e){o.events=e})}function n(){o.events=[],e.load().then(function(e){o.events=e})}var o=this;return o.remove=function(t){e.remove(t).then(function(){n()})},t(),o}angular.module("healthcafe.bloodpressure").controller("BloodPressureController",e),e.$inject=["BloodPressure"]}(),function(){function e(e){return e.getInstance({namespace:"omh",name:"blood-pressure",version:"1.0"},function(e){return{systolic_blood_pressure:{value:e.systolic,unit:"mmHg"},diastolic_blood_pressure:{value:e.diastolic,unit:"mmHg"}}})}angular.module("healthcafe.bloodpressure").factory("BloodPressure",e),e.$inject=["Datapoints"]}(),function(){angular.module("healthcafe.bloodpressure").controller("BloodPressureCreateController",["$ionicHistory","BloodPressure",GenericCreateController])}(),function(){function e(e){return e.getInstance({namespace:"omh",name:"body-weight",version:"1.0"},function(e){return{body_weight:{value:e.weight,unit:"kg"}}})}angular.module("healthcafe.bodyweight").factory("BodyWeight",e),e.$inject=["Datapoints"]}(),function(){angular.module("healthcafe.bodyweight").controller("BodyWeightCreateController",["$ionicHistory","BodyWeight",GenericCreateController])}(),function(){function e(e,t,n,o){var r=function(e,t){this.schema=e,this.converter=t,this.cache=null};return r.prototype.load=function(){var t="http://localhost:8080/nrc/api/openmhealth/v1/dataPoints?schema_namespace="+encodeURIComponent(this.schema.namespace)+"&schema_name="+encodeURIComponent(this.schema.name)+"&schema_version="+encodeURIComponent(this.schema.version),n=this;return e.get(t).then(function(e){return n.cache=e.data,n.cache})},r.prototype.list=function(){return this.cache?t.when(this.cache):this.load()},r.prototype.get=function(t){var n="http://localhost:8080/nrc/api/openmhealth/v1/dataPoints/"+t;return e.get(n)},r.prototype.remove=function(t){var n="http://localhost:8080/nrc/api/openmhealth/v1/dataPoints/"+t;return e["delete"](n)},r.prototype.create=function(t){var n="http://localhost:8080/nrc/api/openmhealth/v1/dataPoints";this.converter&&(t=this.converter(t));var o=this.createDatapoint(t);return e.post(n,o)},r.prototype.defaults=function(){return{}},r.prototype.createDatapoint=function(e){return{header:{id:n.newuuid(),creation_date_time:new Date,acquisition_provenance:{source_name:"Manual",source_creation_date_time:new Date,modality:"self-reported"},schema_id:this.schema},body:e}},{getInstance:function(e,t){return new r(e,t)}}}angular.module("healthcafe.generic").factory("Datapoints",e),e.$inject=["$http","$q","uuid2","OAuth2"]}(),function(){function e(e,t){var n=this;return e.$on("event:auth-unauthorized",function(e,t){$state.go("login")}),n.resetNav=function(){t.nextViewOptions({disableBack:!0})},this}angular.module("healthcafe.intro").controller("IntroController",e),e.$inject=["$scope","$ionicHistory"]}(),function(){function e(e){function t(){var e=window.localStorage.getItem("token");return e?JSON.parse(e):null}function n(){return!!t()}function o(){var e=t();return e?e.oauth.access_token:null}function r(){var t=e.current().api;url=t.urls.autorization+"?client_id="+t.key+"&redirect_uri="+encodeURIComponent(t.urls.redirect)+"&response_type=token&scope=read_data_points write_data_points delete_data_points",window.location.href=url}function a(){window.localStorage.removeItem("token")}return{isAuthenticated:n,getAccessToken:o,login:r,logoff:a}}angular.module("healthcafe.login").factory("OAuth2",e),e.$inject=["config"]}(),function(){function e(e,t,n){function o(t){return t.headers.Accept="application/json",t.headers.Authorization="Bearer "+e.getAccessToken(),t}function r(e){var o=e.config||{};if(!o.ignoreAuthModule)switch(e.status){case 401:t.$broadcast("event:auth-unauthorized",e);break;case 403:t.$broadcast("event:auth-forbidden",e)}return n.reject(e)}return{request:o,responseError:r}}angular.module("healthcafe.login").factory("OAuth2Interceptor",e),e.$inject=["OAuth2","$rootScope","$q"]}(),function(){function e(e){function t(){o.remarks=[],e.list().then(function(e){o.remarks=e})}function n(){o.remarks=[],e.load().then(function(e){o.remarks=e})}var o=this;return o.remove=function(t){e.remove(t).then(function(){n()})},t(),o}angular.module("healthcafe.remarks").controller("RemarksController",e),e.$inject=["Remarks"]}(),function(){function e(e){function t(){return e.when(a)}function n(t){for(i=0;i<a.length;i++)if(a[i].id==t)return e.when(a[i]);return e.fail("Not found")}function o(t){for(i=0;i<a.length;i++)if(a[i].id==t)return e.when(a.splice(i,1));return e.fail("Not found")}function r(t){return t.id||(t.id=Math.max.apply(null,a.map(function(e){return e.id}))+1),a.push(t),e.when(t)}var a=[{id:1,date:new Date(2016,0,1,10,20,30),message:"Started using blood pressure medicine"},{id:2,date:new Date(2016,0,9,10,20,30),message:"Severe flu"}];return{create:r,load:t,list:t,remove:o,get:n,defaults:function(){return{date:new Date}}}}angular.module("healthcafe.remarks").factory("Remarks",e),e.$inject=["$q"]}(),function(){angular.module("healthcafe.bloodpressure").controller("RemarksCreateController",["$ionicHistory","Remarks",GenericCreateController])}(),function(){function e(e,t,n,o,r){function a(e){return{datapoint:e,date:e.header.creation_date_time,badgeIconClass:d[e.header.schema_id.name].icon,badgeClass:d[e.header.schema_id.name].color,type:"measurement",measurementType:e.header.schema_id.name}}function i(e){return angular.extend({},e,{badgeIconClass:"ion-flash",badgeClass:"danger",type:"intervention"})}function l(e){var t=c(e.map(function(e){return e.map(function(e){return e.header&&e.body?a(e):i(e)})}));return t.sort(function(e,t){return new Date(t.date)-new Date(e.date)})}function c(e){return[].concat.apply([],e)}function u(e){s.events=[],o.all(e.map(function(e){return e.list()})).then(function(e){s.events=l(e)})}var s=this,d={"blood-pressure":{icon:"ion-compass",color:"info"},"body-weight":{icon:"ion-speedometer",color:"warning"}};return u([e,t,n]),r.fromTemplateUrl("app/timeline/add_menu.html").then(function(e){s.popover=e}),s}angular.module("healthcafe.timeline").controller("TimelineController",e),e.$inject=["BloodPressure","BodyWeight","Remarks","$q","$ionicPopover"]}();